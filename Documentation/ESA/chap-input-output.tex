\chapter{Functions for input and output}

The \sysname{} library provides facilities for loading a buffer from a
file, and saving a buffer to a file.  The \package{esa-io} package
contains symbols related to this functionality.

\Defcommandtable {esa-io:esa-io-table}

This command table contains a number of commands and related key
bindings related to input/output.  Typically, an application that
needs such i/o would inherit from this command table when creating its
global command table.

\Defcommand {com-find-file} {((file-name \texttt{pathname}))}

This command is similar to the \emacs{} command with the same name.

If no argument is given, this command prompts for a file-name to load
into a fresh buffer which then becomes the current buffer.

If a buffer is already visiting that file, it instead switches to that
buffer.

If the file-name given does not name an existing file, a fresh buffer
is created that is associated with the file-name given, but no file is
created.

This command is bound to the keyboard shortcut \kbd{C-x C-f}.

\Defcommand {com-find-file-read-only} {((file-name \texttt{pathname}))}

This command is similar to \command{find-file}, except that after
reading the contents of the file into a buffer, it sets the read-only
flag of the buffer to \emph{true}.

If no argument is given, this command prompts for a file-name to load
into a fresh buffer which then becomes the current buffer.

If a buffer is already visiting that file, it instead switches to that
buffer.

If the file-name given does not name an existing file, an error is
signaled.

This command is bound to the keyboard shortcut \kbd{C-x C-r}.

\Defcommand {com-read-only} {()}

This command toggles the read-only flag of the current buffer.

This command is bound to the keyboard shortcut \kbd{C-x C-q}.


The commands that are supplied by this table
are \command{com-find-file} (\kbd{C-x C-f}),
\command{com-find-file-read-only} (\kbd{C-x C-r}),
\command{com-read-only} (\kbd{C-x C-q}) which toggle the read-only
flag of the buffer, \command{com-set-visited-file-name} (available as
an extended command only) which prompts for a file name to be
associated with the current buffer, \command{com-save-buffer}
(\kbd{C-x C-s}), and \command{com-write-buffer} (\kbd{C-x C-w}).

These commands handle prompting for file names, searching for existing
buffers with the file name given, Emacs-style file versioning, and
more.  The only thing they need help from the application with is for
saving a buffer to a stream, and for creating a buffer from a stream.
For that, the \sysname{} library calls the generic functions
\function{esa-buffer:frame-save-buffer-to-stream} and
\function{esa-buffer:frame-make-buffer-from-stream} respectively.
Applications that use the \sysname{} i/o facility must provide methods
on these generic functions, specialized on the particular class of the
application frame.  Applications should also provide a method on
\function{esa-buffer:frame-make-new-buffer} so that the \sysname{}
library can create a new buffer whenever a non-existing file name is
given.

To implement the i/o functions, the \sysname{} i/o facility calls the
generic functions \function{esa-io:frame-find-file},
\function{esa-io:frame-find-file-read-only},
\function{esa-io:frame-set-visited-file-name},
\function{esa-io:frame-save-buffer}, and
\function{esa-io:frame-write-buffer}.  Applications can override these
methods, or provide auxiliary methods on them in order to customize
their behavior.
